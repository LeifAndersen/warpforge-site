HACKING
=======

This file contains advise for how to modify, work within, and contribute to this repo.



Styleguide
----------

Here are some guidelines for how to wrangle prose and the raw markdown.

### indentation

_Tabs_, you monster.

Tabs for indentation.  Spaces for alignment.

This is the only solution that lets one configure tabstop size freely at all times,
and has the great joy of letting the tab key insert tabs and the delete key delete single characters,
while never producing surprise or invoking heuristics about what should actually happen.
Simple rules are good.

### page titles

- Use the `title` property in the frontmatter to set the title that will appear in the page's `<title>` element.
- Put the title of the page, as you want it to be rendered in that page, in an h1 element in the body.
- Optionally, use the `eleventyNavigation.key` property in the frontmatter to override the link name as used in the nav tree.

All three of these can be the same; or, it's acceptable if they differ slightly to keep things fitting on the parts of the screen where they are rendered.

The title should usually be unique (so someone with lots of browser tabs open can tell what's what),
but the `eleventyNavigation.key` can be set to something shorter because it's going to be rendered in context of a nav tree with other words around it.
And the h1 element in the page just has more screen realestate than either of the others to work with, so can be longer, if needed.

For a concrete example: the FAQ page uses "FAQ" as the title and navtitle, but contains "Frequently Asked Questions" as the h1 element within the page itself.

### heading styles

It's preferable to use the underline-style for h1 and h2 in markdown.
They're more visually distinctive.

The h1 element should only be used once.

### heading styles in lists

If making a list of sections (e.g., enumerating all the plugins in a subsystem, or all the projects with comparable features, etc),
consider using an h4 element for members of the list.

(This tends to be the depth of heading anyway, naturally, on most pages.)

### line spacing

Three linebreaks before a new h2 are good style.
This spacing makes it easier to eyeball through the raw markdown quickly.

Two linebreaks before a new h3 may be wise.
Follow the style in the surrounding area if in doubt.

Files should always end in a linebreak.
(Git should nudge you about this, as will most editors.)



Site Configuration
------------------

This site is built using a system called [Eleventy](11ty.dev).

- The content is mostly markdown.
- There are some nunjucks templates in the background controlling all the elements shared across pages.
- "frontmatter" is used in the markdown files to provide some input to this processing.
- And Eleventy also has lots of plugins (which you can see mostly in the `.eleventy.js` file).

### Navigation

Navigation is autogenerated by [a macro](/src/_includes/navigation-macro.njk) that goes through all of the .md pages in /src and checks for [frontmatter](#frontmatter) that tells the macro if the page should be in a subcategory and in that case which one.

### Frontmatter
On normal pages it looks like this:
```
---
title: "Formulas and RunRecords"
layout: base.njk
eleventyNavigation: 
    key: Formulas and RunRecords
    parent: Data, Execution and Formulas
    order: 30
---
```

and is found in (or should be added to) the top of any .md file that exists on the website.

#### Title
The title that you will see when you open the page.

#### Layout
We currently only have one layout for content, so please just stick with `base.njk` on this one.

#### EleventyNavigation
So here we have key, parent and order. 

`key` is the link-name that is shown in the navigation. 

`parent` should point to the parent `key`, if this is to be a subpage of that category. Read more in [Adding a category](#adding-a-category)

`order` is used to sort the pages shown.

#### Adding a category
To add a new category to the navigation you need to create a page with some frontmatter, it is recommended to use folders with the category-name and put an index.md there for the category frontmatter. Pages that correspond to a category should be in that folder as well. Creating nested categories is basically just creating a new category in another category (put a folder in the parent category).

#### Category Frontmatter
```
---
title: "Data, Execution and Formulas"
layout: base.njk
eleventyNavigation: 
    key: Data, Execution and Formulas
    parent: API Specs
    order: 10
---
```

In a category page, there should not be anything other than the frontmatter since this page will not be linked to anyway. The important stuff is in the `eleventyNavigation` part. 

In this case the `parent` points to another category page and thus we have a nested category.



Tooling
-------

### Running the website locally

Clone the project from github, pop out your favourite terminal and move into the directory of this project.

1. run `npm install`.  This will create a `node_modules` folder for all the dependencies required to run the website and download all the dependencies into it.  (This uses pinned versions in the `package-lock.json` file and so should be fairly stable.)
2. run `npm run serve` to start a tiny webserver that will host the website at [http://localhost:8080](http://localhost:8080). (If you have something else running on port 8080 it will just try +1 to the port until it finds a free one.)

When you have the webserver running, every time you make a change to a file the webserver will update with those changes pretty instantly.

### Testing your new pages

We also have some kind of testing added, which mostly just checks so that all the links added in our pages are valid and actually points somewhere.

How to run tests:
1. run `npm run test`
2. check output, if it says any link failed, please fix that link in the corresponding file.


### Updating Dependencies

Yes, sometimes dependencies are a pain, but they are needed, so here's a small rundown on how to update the packages fairly simply.

1. run `npm outdated` to check if there's any updates to be done
2. run `npx npm-check-updates -u` to update all the packages in our package.json to the latest versions
3. please run `npm run serve` and check so everything is running and still looks good after the update is done.
4. push your changes to git üëè
